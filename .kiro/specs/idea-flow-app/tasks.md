# Implementation Plan

- [x] 1. Implement data model for nodes
  - [x] 1.1 Create Node data structure
    - Define node types: Idea, Assumption, Plan, Test, Result, Decision, Lesson
    - Store fields: text, rationale, constraints, metric, threshold, if-then plan, date, time, place, energy rating, expectancy rating, parent and child links
    - _Requirements: 15.1, 15.2_
  - [x] 1.2 Add North Star and Ladder storage
    - Store one pinned North Star per branch
    - Maintain Ladder of next steps that stays visible
    - _Requirements: 15.3, 15.4_

- [x] 2. Build state machine for workflow
  - [x] 2.1 Implement state transitions
    - Support states: Seeded, Diverging, Clarifying, Planning, Testing, Reviewing, Stalled, Action crisis, Archived
    - Transition Seeded to Diverging on save
    - Transition Diverging to Clarifying when slots filled or timer ends
    - Transition Clarifying to Planning when North Star and steps pinned
    - Transition Planning to Testing when thresholds and plan exist
    - Transition Testing to Reviewing on log entry
    - Transition any state to Stalled after two missed plans
    - Transition Stalled to Action crisis on low expectancy
    - Transition any state to Archived on exit or completion
    - _Requirements: 13.2, 13.3, 13.4, 13.5, 13.6, 13.7, 13.8, 13.9, 13.10_

- [x] 3. Create Tree Canvas interface
  - [x] 3.1 Build grid interface for initial capture
    - Display top cell for one-line problem or wish input
    - Provide three small fields for assumptions
    - Pre-select Save button for automatic capture
    - _Requirements: 1.1, 1.2, 1.3_
  - [x] 3.2 Implement node save functionality
    - Store dump on save
    - Name the node
    - Suggest optional tags
    - _Requirements: 1.4_

- [x] 4. Build parallel ideation interface
  - [x] 4.1 Create six idea slots
    - Open six slots when idea is saved
    - Require user to fill at least three before showing AI
    - Hide AI suggestions until minimum user slots filled
    - _Requirements: 2.1, 2.2, 16.2_
  - [x] 4.2 Implement Diverger agent
    - Generate five options avoiding common answers
    - Include one weird option
    - Keep one constrained to one hour
    - Keep one under 100 dollars
    - Fill three AI slots in parallel using anti-prototype and constraint-first prompts
    - _Requirements: 2.3, 13.1, 14.1_
  - [x] 4.3 Add timer for incubation
    - Display timer for short walk or light activity after first pass
    - Resurface same node when timer ends
    - Use short timers and bring back same node
    - _Requirements: 2.4, 2.5, 16.3_

- [x] 5. Create North Star and Ladder interface
  - [x] 5.1 Build North Star card
    - Display why in one line
    - Keep pinned and visible
    - _Requirements: 3.1, 3.2, 3.4_
  - [x] 5.2 Build Ladder beside North Star
    - List first three concrete steps
    - Keep pinned and visible
    - _Requirements: 3.1, 3.3, 3.4_
  - [x] 5.3 Add Mars-adjacent alternatives
    - Allow user to swap any step for alternative
    - Ensure alternative points at same North Star
    - _Requirements: 3.5_

- [x] 6. Implement constraint-based planning
  - [x] 6.1 Wire up LLM service integration
    - Create LLM service wrapper with direct API calls
    - Support Ollama for local development
    - Support OpenRouter for cloud access to multiple models
    - Add configuration for provider and model selection
    - _Requirements: 13.1, 14.1, 14.2, 14.3, 14.4, 14.5_
  - [x] 6.2 Create constraint toggles
    - Provide toggles for time cap, money cap, skills on hand
    - Frame plans by user-selected constraints
    - _Requirements: 4.2_
  - [x] 6.3 Display constraint reminder banner
    - Show banner that moderate meaningful constraints help originality
    - Show note when constraint raises creativity odds
    - _Requirements: 4.3, 16.6_
  - [x] 6.4 Implement Planner agent
    - Offer two or three micro-plans per idea
    - Produce two micro-plans per option under chosen constraints
    - Include one smallest honest test per plan with metric, pass threshold, fail threshold
    - _Requirements: 4.1, 13.1, 14.2_

- [x] 7. Build risk assessment interface
  - [x] 7.1 Create pre-mortem card
    - Display two-minute pre-mortem card before big push
    - Prompt user to write why this could fail
    - _Requirements: 5.1, 5.2_
  - [x] 7.2 Implement Skeptic agent
    - Imagine six months later failure
    - List three most likely causes with one test each
    - Ask which assumption would change first
    - _Requirements: 13.1, 14.3_
  - [x] 7.3 Create outside-view card
    - Pull base rates from similar projects
    - If data scarce, ask user to draw rough reference class
    - _Requirements: 5.3, 5.4_
  - [x] 7.4 Implement Statistician agent
    - List comparable efforts
    - Estimate base rates for success or time to first milestone
    - If no data, ask user to pick three nearest cases and rate similarity
    - _Requirements: 13.1, 14.4_

- [x] 8. Integrate Clarification, Planning, and Risk stages
  - [x] 8.1 Surface Clarification view after ideation
    - Render the Clarification view immediately after the second ideation pass so users can pin a North Star and record three Ladder steps for the active branch
    - Keep Mars-adjacent swaps available while maintaining the pinned North Star context
    - _Requirements: 3.1, 3.2, 3.3, 3.4, 3.5_
  - [x] 8.2 Continue into planning and risk assessment
    - Flow directly from Clarification to Planning so users can pick constraints and request Planner output before leaving the canvas
    - Route successful plan generation into the Risk Assessment sequence so the Pre-mortem, Skeptic, Outside View, and Statistician steps run in order
    - _Requirements: 4.1, 4.2, 4.3, 5.1, 5.2, 5.3, 5.4, 14.2, 14.3, 14.4_
  - [x] 8.3 Persist branch context across stages
    - Pass `branchId`, North Star, Ladder, and plan details between components
    - Store resulting records so downstream stages can reference the same branch artifacts
    - _Requirements: 3.4, 4.1, 5.1, 5.2_

- [x] 9. Implement workflow transitions in the UI
  - [x] 9.1 Emit workflow events from user actions
    - Send SAVE, SLOTS_FILLED, TIMER_ENDED, NORTH_STAR_PINNED, and THRESHOLDS_SET events when the corresponding milestones occur
    - Trigger LOG_ENTRY, PLAN_MISSED, and LOW_EXPECTANCY events from progress logs and energy inputs
    - _Requirements: 13.3, 13.4, 13.5, 13.6, 13.7_
  - [x] 9.2 Persist branch state and missed-plan counts
    - Update branch records with the latest workflow state and `missedPlans` count after each transition
    - Expose live branch state to the UI so later stages stay gated until prior requirements are met
    - _Requirements: 13.2, 13.8, 13.9, 13.10_

- [x] 10. Complete Diverger coverage and AI slot handling
  - [x] 10.1 Return the five required AI suggestions
    - Populate anti-prototype, one-hour, under-$100, weird, and skills-on-hand slots instead of truncating to three
    - Label each AI slot so users see which constraint produced it
    - _Requirements: 2.3, 14.1_
  - [x] 10.2 Keep AI results available after prerequisites
    - Continue hiding AI suggestions until three user ideas exist, then retain the generated ideas when the node resurfaces
    - _Requirements: 2.2, 16.2_

- [x] 11. Enforce purposeful incubation and resurfacing
  - [x] 11.1 Auto-start incubation timer on completion
    - Trigger the short walk / light activity timer once first-pass ideation finishes and nudge breaks when users report low energy
    - _Requirements: 2.4, 10.1_
  - [x] 11.2 Restore the same node after incubation
    - Reopen the original ideation slots with previously entered ideas and AI suggestions after the timer ends
    - _Requirements: 2.5, 10.2, 16.3_

- [x] 12. Persist node naming on save
  - [x] 12.1 Add node name storage
    - Extend the node schema and save API to store the generated node name alongside the text dump
    - _Requirements: 1.4_
  - [x] 12.2 Return stored names to the UI
    - Use the persisted name in confirmation, tree views, and later stages instead of recomputing client-side
    - _Requirements: 1.4_

- [x] 13. Create test selection interface
  - [x] 13.1 Propose smallest honest tests
    - Propose two or three smallest honest tests per plan
    - Allow user to select tests
    - _Requirements: 6.1, 6.2_
  - [x] 13.2 Capture test criteria
    - Prompt for metric
    - Prompt for pass or fail threshold
    - Record test definitions in node
    - _Requirements: 6.3, 6.4_

- [x] 14. Build if-then planning interface
  - [x] 14.1 Prompt for if-then plan
    - Prompt after any dump or plan change
    - Include date, time, place fields
    - Store if-then plan with node
    - _Requirements: 7.1, 7.2, 7.3_
  - [x] 14.2 Implement Coach agent for planning
    - Turn user actions into if-then plans with date, time, place
    - _Requirements: 13.1, 14.5_

- [x] 15. Create progress logging interface
  - [x] 15.1 Display Log progress button
    - Show one-tap button after planned test window
    - Ask what happened, what learned, what next
    - _Requirements: 8.1, 8.2_
  - [x] 15.2 Implement accountability reporting
    - Offer optional accountability sending weekly report to user or partner
    - Show only recorded outcomes and learning notes
    - Avoid streaks or likes
    - Show clear progress lines and learning notes
    - _Requirements: 8.3, 16.4_

- [x] 16. Implement Coach agent critique
  - [x] 16.1 Create critique scaffolding
    - State the bar
    - Affirm ability to reach it
    - Give specific process changes
    - Rewrite critique into high standards with assurance and concrete steps
    - _Requirements: 9.1, 13.1, 14.5_
  - [x] 16.2 Avoid harmful feedback patterns
    - Avoid person labels
    - Keep focus on assumptions and evidence
    - _Requirements: 9.2_

- [x] 17. Build incubation support
  - [x] 17.1 Detect stall or low energy
    - Monitor when user stalls or returns low-energy
    - _Requirements: 10.1_
  - [x] 17.2 Recommend breaks
    - Recommend 10 to 15 minute undemanding break or short walk
    - Reopen same node for second pass when user returns
    - _Requirements: 10.1, 10.2_

- [x] 18. Create action crisis interface
  - [x] 18.1 Detect stalled progress
    - Open Action crisis card if repeated logs show little movement or low expectancy
    - _Requirements: 11.1_
  - [x] 18.2 Offer recommit or exit
    - Offer two week recommit or exit test with clear metrics
    - If exit, provide fast re-engage path to different route serving same North Star
    - _Requirements: 11.2, 11.3_

- [x] 19. Implement learning archive
  - [x] 19.1 Create archive page on completion
    - When branch finished or exited, write page with tests, evidence, one sentence advice to future self
    - _Requirements: 12.1_
  - [x] 19.2 Feed archive into outside view
    - Use archive to feed outside-view step next time
    - _Requirements: 12.2_

- [ ] 20. Add post-capture UX patterns
  - [ ] 20.1 Show save confirmation
    - Show Save confirmed after capture
    - Display nudge to plan
    - _Requirements: 16.1_

- [ ] 21. Implement team features
  - [ ] 21.1 Add anonymous idea collection
    - Offer anonymous idea collection in teams to reduce evaluation fear
    - _Requirements: 16.5_

- [ ] 22. Build metrics tracking
  - [ ] 22.1 Track acquisition metrics
    - Track number of seeds per user
    - Track percent that reach planning
    - Track percent that set date and place
    - _Requirements: 17.1_
  - [ ] 22.2 Track execution metrics
    - Track tests scheduled within seven days
    - Track planned tests that actually run
    - Track pass or fail rates
    - Track time to first result
    - _Requirements: 17.2_
  - [ ] 22.3 Track learning metrics
    - Track average number of lessons per branch
    - Track number of archive pages read before new planning
    - _Requirements: 17.3_
  - [ ] 22.4 Track motivation metrics
    - Track energy and expectancy slider values after sessions
    - Track trend lines per branch
    - Track number of novelty injections chosen
    - _Requirements: 17.4_
  - [ ] 22.5 Track quality metrics
    - Track share of ideas that progressed from seed to at least one honest test then to decision
    - _Requirements: 17.5_
